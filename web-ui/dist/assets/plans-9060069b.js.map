{"version":3,"file":"plans-9060069b.js","sources":["../../src/api/plans.ts"],"sourcesContent":["import { BaseApi } from './client';\nimport { mergeWithScope, resolveScopeParams, ScopeOverrides } from './scope';\nimport { Plan, PlanProposal, PlanTaskNode } from '../types/index';\n\nexport class PlansApi extends BaseApi {\n  // 提议计划 - 使用箭头函数确保this绑定\n  proposePlan = async (proposal: PlanProposal): Promise<Plan> => {\n    return this.post<Plan>('/plans/propose', proposal);\n  }\n\n  // 批准计划\n  approvePlan = async (plan: Plan): Promise<void> => {\n    return this.post<void>('/plans/approve', plan);\n  }\n\n  // 获取所有计划\n  getAllPlans = async (filters?: ScopeOverrides): Promise<{ plans: string[] }> => {\n    return this.get<{ plans: string[] }>('/plans', resolveScopeParams(filters));\n  }\n\n  // 获取计划标题列表（便捷封装）\n  listPlanTitles = async (filters?: ScopeOverrides): Promise<string[]> => {\n    const data = await this.getAllPlans(filters);\n    if (data && Array.isArray(data.plans)) {\n      return data.plans;\n    }\n    return [];\n  }\n\n  // 获取计划任务\n  getPlanTasks = async (title: string, filters?: ScopeOverrides): Promise<PlanTaskNode[]> => {\n    return this.get<PlanTaskNode[]>(`/plans/${encodeURIComponent(title)}/tasks`, resolveScopeParams(filters));\n  }\n\n  // 获取计划详情\n  getPlan = async (title: string): Promise<Plan> => {\n    return this.get<Plan>(`/plans/${encodeURIComponent(title)}`);\n  }\n\n  // 删除计划\n  deletePlan = async (title: string): Promise<void> => {\n    return this.delete<void>(`/plans/${encodeURIComponent(title)}`);\n  }\n\n  // 获取计划状态\n  getPlanStatus = async (title: string): Promise<{\n    total_tasks: number;\n    completed_tasks: number;\n    failed_tasks: number;\n    pending_tasks: number;\n    progress_percentage: number;\n    estimated_completion?: string;\n  }> => {\n    return this.get(`/plans/${encodeURIComponent(title)}/status`);\n  }\n\n  // 递归分解计划\n  decomposePlan = async (\n    title: string,\n    options: {\n      max_depth?: number;\n      force?: boolean;\n      tool_aware?: boolean;\n    } = {}\n  ): Promise<{\n    success: boolean;\n    message: string;\n    new_tasks_count: number;\n    total_tasks_count: number;\n  }> => {\n    return this.post(`/plans/${encodeURIComponent(title)}/decompose`, options);\n  }\n\n  // 导出计划\n  exportPlan = async (\n    title: string,\n    format: 'json' | 'markdown' | 'pdf' = 'json'\n  ): Promise<Blob> => {\n    const response = await this.client.get(\n      `/plans/${encodeURIComponent(title)}/export`,\n      {\n        params: { format },\n        responseType: 'blob',\n      }\n    );\n    return response.data;\n  }\n\n  // 复制计划\n  copyPlan = async (sourceTitle: string, newTitle: string): Promise<Plan> => {\n    return this.post<Plan>(`/plans/${encodeURIComponent(sourceTitle)}/copy`, {\n      new_title: newTitle,\n    });\n  }\n\n  // 获取计划模板\n  getPlanTemplates = async (): Promise<{\n    id: string;\n    name: string;\n    description: string;\n    category: string;\n    tasks_count: number;\n  }[]> => {\n    return this.get('/plans/templates', resolveScopeParams());\n  }\n\n  // 从模板创建计划\n  createFromTemplate = async (\n    templateId: string,\n    title: string,\n    customizations?: Record<string, any>\n  ): Promise<Plan> => {\n    return this.post(`/plans/templates/${templateId}/create`, mergeWithScope({\n      title,\n      customizations,\n    }));\n  }\n}\n\nexport const plansApi = new PlansApi();\n"],"names":["PlansApi","BaseApi","__publicField","proposal","plan","filters","resolveScopeParams","data","title","options","format","sourceTitle","newTitle","templateId","customizations","mergeWithScope","plansApi"],"mappings":"mTAIO,MAAMA,UAAiBC,CAAQ,CAA/B,kCAELC,EAAA,mBAAc,MAAOC,GACZ,KAAK,KAAW,iBAAkBA,CAAQ,GAInDD,EAAA,mBAAc,MAAOE,GACZ,KAAK,KAAW,iBAAkBA,CAAI,GAI/CF,EAAA,mBAAc,MAAOG,GACZ,KAAK,IAAyB,SAAUC,EAAmBD,CAAO,CAAC,GAI5EH,EAAA,sBAAiB,MAAOG,GAAgD,CACtE,MAAME,EAAO,MAAM,KAAK,YAAYF,CAAO,EAC3C,OAAIE,GAAQ,MAAM,QAAQA,EAAK,KAAK,EAC3BA,EAAK,MAEP,EAAC,GAIVL,EAAA,oBAAe,MAAOM,EAAeH,IAC5B,KAAK,IAAoB,UAAU,mBAAmBG,CAAK,CAAC,SAAUF,EAAmBD,CAAO,CAAC,GAI1GH,EAAA,eAAU,MAAOM,GACR,KAAK,IAAU,UAAU,mBAAmBA,CAAK,CAAC,EAAE,GAI7DN,EAAA,kBAAa,MAAOM,GACX,KAAK,OAAa,UAAU,mBAAmBA,CAAK,CAAC,EAAE,GAIhEN,EAAA,qBAAgB,MAAOM,GAQd,KAAK,IAAI,UAAU,mBAAmBA,CAAK,CAAC,SAAS,GAI9DN,EAAA,qBAAgB,MACdM,EACAC,EAII,KAOG,KAAK,KAAK,UAAU,mBAAmBD,CAAK,CAAC,aAAcC,CAAO,GAI3EP,EAAA,kBAAa,MACXM,EACAE,EAAsC,UAErB,MAAM,KAAK,OAAO,IACjC,UAAU,mBAAmBF,CAAK,CAAC,UACnC,CACE,OAAQ,CAAE,OAAAE,CAAO,EACjB,aAAc,MAChB,CAAA,GAEc,MAIlBR,EAAA,gBAAW,MAAOS,EAAqBC,IAC9B,KAAK,KAAW,UAAU,mBAAmBD,CAAW,CAAC,QAAS,CACvE,UAAWC,CAAA,CACZ,GAIHV,EAAA,wBAAmB,SAOV,KAAK,IAAI,mBAAoBI,EAAoB,CAAA,GAI1DJ,EAAA,0BAAqB,MACnBW,EACAL,EACAM,IAEO,KAAK,KAAK,oBAAoBD,CAAU,UAAWE,EAAe,CACvE,MAAAP,EACA,eAAAM,CACD,CAAA,CAAC,GAEN,CAEa,MAAAE,EAAW,IAAIhB"}