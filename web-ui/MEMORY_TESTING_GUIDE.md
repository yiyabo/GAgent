# Memory-MCP 功能测试指南

本文档提供Memory-MCP管理模块的完整测试指南,涵盖功能测试、UI交互测试、性能测试和边界情况测试。

## 📋 测试前准备

### 1. 环境检查
```bash
# 1. 确认后端服务运行
curl http://localhost:9000/health

# 2. 确认前端开发服务器运行
cd web-ui
npm run dev

# 3. 浏览器访问
http://localhost:5173
```

### 2. 必要的测试数据
- 至少10条测试记忆(不同类型、重要性、标签)
- 包含记忆连接(links)的数据
- 空状态(无记忆数据)

---

## 🧪 Phase 8: 功能测试清单

### ✅ 1. 页面基础功能测试

#### 1.1 页面加载与导航
- [ ] 从侧边栏点击"记忆管理"菜单项,页面正常加载
- [ ] URL路径为 `/memory`
- [ ] 页面标题显示"记忆管理"和BrainOutlined图标
- [ ] 页面说明文字正确显示

#### 1.2 统计看板测试
- [ ] 统计卡片正确显示4个指标:
  - 总记忆数
  - 平均连接数
  - 嵌入覆盖率(带进度条)
  - 进化次数
- [ ] 数值与后端返回一致
- [ ] 嵌入覆盖率颜色根据阈值变化(>0.8绿色,否则橙色)
- [ ] 30秒自动刷新功能正常

#### 1.3 响应式布局测试
- [ ] 在不同屏幕尺寸下统计卡片正确排列:
  - Desktop (>= 1200px): 4列
  - Tablet (768-1200px): 2列
  - Mobile (< 768px): 1列

---

### ✅ 2. 搜索与过滤功能

#### 2.1 搜索功能
- [ ] 输入搜索关键词,500ms防抖生效
- [ ] 搜索内容匹配记忆content
- [ ] 搜索关键词匹配记忆keywords
- [ ] 搜索标签匹配记忆tags
- [ ] 搜索框显示loading状态
- [ ] 点击清除按钮清空搜索
- [ ] 按回车触发搜索

#### 2.2 类型过滤
- [ ] 选择单个记忆类型,列表正确过滤
- [ ] 选择多个记忆类型,显示所有匹配项
- [ ] 过滤器显示已选择的数量
- [ ] 清除按钮清空所有类型过滤

#### 2.3 重要性过滤
- [ ] 选择单个重要性级别,列表正确过滤
- [ ] 选择多个重要性级别,显示所有匹配项
- [ ] 过滤器正确显示标签

#### 2.4 组合过滤
- [ ] 搜索 + 类型过滤组合生效
- [ ] 搜索 + 重要性过滤组合生效
- [ ] 类型 + 重要性过滤组合生效
- [ ] 三者组合过滤生效
- [ ] 清除筛选按钮一键清空所有过滤条件

---

### ✅ 3. 列表视图功能

#### 3.1 表格显示
- [ ] 表格正确显示8列:
  - ID(截断显示)
  - 内容(超过100字符截断)
  - 类型(带颜色标签)
  - 重要性(带颜色标签)
  - 关键词(最多显示3个)
  - 相似度(百分比,带颜色)
  - 检索次数
  - 创建时间(相对时间)
  - 操作按钮
- [ ] 鼠标悬停在截断文本上显示完整tooltip

#### 3.2 排序功能
- [ ] 点击"相似度"列头,按相似度排序
- [ ] 点击"检索次数"列头,按检索次数排序
- [ ] 点击"创建时间"列头,按时间排序
- [ ] 升序/降序切换正常

#### 3.3 分页功能
- [ ] 页面底部正确显示分页控件
- [ ] 显示总记录数 "共 X 条记忆"
- [ ] 可以选择每页显示数量 (10/20/50/100)
- [ ] 翻页功能正常
- [ ] 快速跳转页码功能正常

#### 3.4 表格内筛选
- [ ] 类型列的筛选器正常工作
- [ ] 重要性列的筛选器正常工作
- [ ] 筛选结果正确

---

### ✅ 4. 图谱视图功能

#### 4.1 图谱切换
- [ ] 点击"图谱视图"标签,切换到图谱视图
- [ ] 图谱正确渲染所有记忆节点
- [ ] 图谱显示记忆连接边

#### 4.2 节点渲染
- [ ] 节点大小 = 重要性基础大小 + 检索次数加成
- [ ] 节点颜色根据重要性正确显示:
  - 关键: 红色 (#ff4d4f)
  - 高: 橙色 (#fa8c16)
  - 中: 蓝色 (#1890ff)
  - 低: 绿色 (#52c41a)
  - 临时: 灰色 (#d9d9d9)
- [ ] 节点形状根据类型正确显示:
  - 对话: box (方形)
  - 经验: ellipse (椭圆)
  - 知识: diamond (菱形)
  - 上下文: star (星形)

#### 4.3 边渲染
- [ ] 相似度 >0.8: 绿色粗边(宽度5)
- [ ] 相似度 0.6-0.8: 蓝色中边(宽度3)
- [ ] 相似度 <0.6: 灰色细边(宽度2)
- [ ] 边上显示相似度百分比标签

#### 4.4 图谱交互
- [ ] 鼠标悬停节点显示详细tooltip
- [ ] 点击节点打开详情Drawer
- [ ] 拖拽节点改变位置(force布局)
- [ ] 鼠标滚轮缩放视图
- [ ] 拖拽背景平移视图

#### 4.5 图谱控制
- [ ] 搜索框过滤节点正常
- [ ] 相似度阈值滑块过滤边正常
- [ ] 布局切换功能:
  - 力导向布局: 节点自由分布
  - 层次布局: 节点分层排列
  - 环形布局: 节点环形排列
- [ ] 标签显示/隐藏切换
- [ ] "适应视图"按钮自动缩放
- [ ] "全屏"按钮进入/退出全屏
- [ ] "刷新"按钮重新构建图谱

#### 4.6 图例显示
- [ ] 左上角图例正确显示
- [ ] 图例包含:
  - 节点大小说明
  - 重要性颜色说明
  - 类型形状说明
  - 连接线说明
  - 操作提示

---

### ✅ 5. 保存记忆功能

#### 5.1 打开表单
- [ ] 点击"保存新记忆"按钮打开Modal
- [ ] Modal标题显示"💾 保存新记忆"
- [ ] 表单显示7个字段

#### 5.2 表单验证
- [ ] 记忆内容: 必填,10-5000字符
- [ ] 记忆类型: 必选
- [ ] 重要性级别: 必选
- [ ] 标签: 可选,多选
- [ ] 关键词: 可选,多选
- [ ] 上下文: 可选
- [ ] 关联任务ID: 可选,数字类型

#### 5.3 表单提交
- [ ] 填写所有必填项,点击"保存"
- [ ] 显示loading状态
- [ ] 成功后显示"✅ 记忆保存成功!"
- [ ] Modal自动关闭
- [ ] 列表自动刷新显示新记忆
- [ ] 统计数据自动更新

#### 5.4 错误处理
- [ ] 不填必填项无法提交
- [ ] 内容少于10字符显示错误提示
- [ ] 内容超过5000字符显示错误提示
- [ ] API错误显示友好错误消息

#### 5.5 表单重置
- [ ] 关闭Modal自动重置表单
- [ ] 取消按钮关闭Modal
- [ ] 再次打开表单显示默认值

---

### ✅ 6. 记忆详情功能

#### 6.1 打开详情
- [ ] 点击列表中的"查看详情"按钮
- [ ] Drawer从右侧滑出
- [ ] 显示选中记忆的完整信息

#### 6.2 统计卡片
- [ ] 显示3个统计卡片:
  - 检索次数(带EyeOutlined图标)
  - 相似度(百分比,带颜色)
  - 连接数(带LinkOutlined图标)
- [ ] 数值正确显示

#### 6.3 基础信息
- [ ] 记忆ID可复制
- [ ] 记忆类型带说明
- [ ] 重要性带说明
- [ ] 上下文显示
- [ ] 关联任务ID(如果有)

#### 6.4 内容显示
- [ ] 记忆内容完整显示
- [ ] 支持换行和长文本
- [ ] 背景色区分

#### 6.5 标签和关键词
- [ ] 标签显示为蓝色Tag
- [ ] 关键词显示为紫色Tag
- [ ] 支持多个标签/关键词

#### 6.6 记忆连接
- [ ] 显示所有连接的记忆
- [ ] 每个连接显示:
  - 目标记忆ID
  - 相似度百分比(带颜色)
- [ ] 连接ID可悬停查看完整ID

#### 6.7 时间信息
- [ ] 创建时间:绝对时间 + 相对时间
- [ ] 最后访问时间(如果有)

---

### ✅ 7. 错误处理测试

#### 7.1 API错误
- [ ] 关闭后端服务,测试错误提示
- [ ] 统计信息加载失败显示红色Alert
- [ ] 记忆列表加载失败显示红色Alert
- [ ] Alert包含"重试"按钮
- [ ] 点击"重试"按钮重新请求

#### 7.2 网络错误
- [ ] 断网情况下显示友好错误消息
- [ ] 自动重试机制生效(最多2次)
- [ ] 指数退避延迟正确

#### 7.3 空状态
- [ ] 无记忆数据时显示Empty组件
- [ ] 图谱视图无数据时显示Empty
- [ ] 搜索无结果时显示Empty

#### 7.4 组件错误
- [ ] 组件渲染错误被ErrorBoundary捕获
- [ ] 显示错误UI和恢复按钮
- [ ] 开发环境显示错误堆栈

---

### ✅ 8. 性能测试

#### 8.1 列表性能
- [ ] 100条记忆数据流畅渲染
- [ ] 分页切换无明显延迟
- [ ] 排序操作响应快速
- [ ] 过滤操作响应快速

#### 8.2 图谱性能
- [ ] 50个节点流畅渲染
- [ ] 100个节点可接受
- [ ] 相似度阈值调整立即生效
- [ ] 布局切换无明显卡顿

#### 8.3 搜索防抖
- [ ] 快速输入时不触发多次请求
- [ ] 停止输入500ms后才发送请求
- [ ] 防抖期间显示loading状态

#### 8.4 内存泄漏
- [ ] 切换标签页无内存泄漏
- [ ] 打开/关闭Modal多次无泄漏
- [ ] 打开/关闭Drawer多次无泄漏
- [ ] 组件卸载时正确清理

---

### ✅ 9. 可访问性测试

#### 9.1 键盘导航
- [ ] Tab键可以遍历所有交互元素
- [ ] Enter键可以触发按钮
- [ ] Escape键可以关闭Modal/Drawer
- [ ] 焦点顺序符合逻辑

#### 9.2 屏幕阅读器
- [ ] 所有图标有aria-label
- [ ] 表单字段有正确的label
- [ ] 错误提示可被读取
- [ ] 按钮文本清晰描述功能

---

### ✅ 10. 浏览器兼容性

#### 10.1 Chrome
- [ ] 所有功能正常
- [ ] 样式正确显示
- [ ] 动画流畅

#### 10.2 Firefox
- [ ] 所有功能正常
- [ ] 样式正确显示
- [ ] 动画流畅

#### 10.3 Safari
- [ ] 所有功能正常
- [ ] 样式正确显示
- [ ] 动画流畅

#### 10.4 Edge
- [ ] 所有功能正常
- [ ] 样式正确显示
- [ ] 动画流畅

---

## 🐛 已知问题与限制

### 当前限制
1. 图谱视图对超过200个节点的性能未优化
2. 搜索不支持正则表达式
3. 批量操作功能未实现(导出、删除)

### 未来增强
1. 记忆编辑功能
2. 批量导出为JSON/CSV
3. 高级搜索(日期范围、相似度范围)
4. 记忆历史版本追踪

---

## 📊 测试结果模板

```markdown
## Memory-MCP 测试结果

**测试日期**: YYYY-MM-DD
**测试人员**: XXX
**测试环境**:
- 浏览器: Chrome 120.0
- 操作系统: macOS 14.0
- 后端版本: v1.0.0

### 测试通过率
- [ ] 页面基础功能: X/X (100%)
- [ ] 搜索与过滤: X/X (100%)
- [ ] 列表视图: X/X (100%)
- [ ] 图谱视图: X/X (100%)
- [ ] 保存记忆: X/X (100%)
- [ ] 记忆详情: X/X (100%)
- [ ] 错误处理: X/X (100%)
- [ ] 性能测试: X/X (100%)

### 发现的问题
1. [严重] XXX
2. [中等] XXX
3. [轻微] XXX

### 建议
1. XXX
2. XXX
```

---

## 🎯 自动化测试建议

### 单元测试
```typescript
// Memory.test.tsx
describe('Memory Page', () => {
  test('renders correctly', () => {});
  test('handles search input', () => {});
  test('filters memories by type', () => {});
});
```

### 集成测试
```typescript
// memoryApi.test.ts
describe('Memory API', () => {
  test('saves memory successfully', () => {});
  test('queries memories with filters', () => {});
  test('handles API errors', () => {});
});
```

### E2E测试(Playwright/Cypress)
```typescript
describe('Memory E2E', () => {
  test('complete workflow: save -> search -> view', () => {});
  test('graph visualization interaction', () => {});
});
```

---

## 📞 问题反馈

如发现任何问题,请提供:
1. 问题描述
2. 复现步骤
3. 期望行为
4. 实际行为
5. 截图/录屏(如适用)
6. 浏览器/操作系统信息

---

**最后更新**: 2025-10-13
