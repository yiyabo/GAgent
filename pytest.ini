[tool:pytest]
# pytest配置文件，用于统一管理测试行为

# 测试路径
testpaths = tests

# 警告过滤器配置
filterwarnings =
    # 忽略已知的第三方库警告
    ignore::DeprecationWarning:pkg_resources.*
    ignore::DeprecationWarning:setuptools.*
    ignore::PendingDeprecationWarning:asyncio.*
    
    # 将我们自己的弃用警告转为错误，确保及时修复
    error::DeprecationWarning:app.*
    error::DeprecationWarning:tests.*
    
    # 忽略一些不重要的警告
    ignore::ResourceWarning
    ignore::UserWarning:matplotlib.*
    ignore::UserWarning:numpy.*
    
    # SQLite相关的无害警告
    ignore::DeprecationWarning:sqlite3.*
    
    # Threading相关的警告（已修复，但可能还有其他来源）
    error::DeprecationWarning:.*notifyAll.*

# 添加自定义标记
markers =
    slow: 标记慢速测试
    integration: 标记集成测试
    unit: 标记单元测试
    concurrent: 标记并发测试
    
# 日志配置
log_cli = false
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# 输出控制
addopts = 
    --strict-markers
    --tb=short
    -v
    --color=yes
    --durations=10

# 最小版本要求
minversion = 6.0

# 并发测试支持
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*